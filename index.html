<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한국어 능력 평가 실험</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            margin: 0;
            min-height: 100vh;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
            color: #667eea; 
            border-bottom: 2px solid #667eea;
            padding-bottom: 20px;
        }
        .timer { 
            background: #ff6b6b; 
            color: white; 
            padding: 15px; 
            text-align: center; 
            border-radius: 10px; 
            margin: 20px 0; 
            font-size: 1.2em; 
            font-weight: bold; 
        }
        .passage { 
            border: 2px solid #e0e0e0; 
            border-radius: 10px; 
            padding: 25px; 
            margin: 20px 0; 
            background: #fafafa;
        }
        .passage h3 { 
            color: #667eea; 
            margin-bottom: 15px; 
            font-size: 1.3em;
        }
        .passage-text { 
            line-height: 2; 
            font-size: 1.1em; 
        }
        .blank { 
            display: inline-block; 
            width: 28px; 
            height: 28px; 
            border: none;
            border-bottom: 2px solid #667eea; 
            margin: 0 3px; 
            text-align: center; 
            font-size: 1em; 
            background: #f8f9ff; 
            padding: 2px;
            vertical-align: baseline;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 0;
        }
        .blank:focus { 
            outline: none; 
            background: #fff; 
            border-bottom-color: #ff6b6b; 
            box-shadow: 0 2px 5px rgba(102,126,234,0.3);
        }
        .btn { 
            padding: 15px 30px; 
            background: #667eea; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 1.1em; 
            cursor: pointer; 
            margin: 10px; 
        }
        .btn:hover { 
            background: #5a6fd8; 
            transform: translateY(-2px);
        }
        .form-group { 
            margin: 15px 0; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
        }
        .form-group input, .form-group select { 
            padding: 10px; 
            width: 100%; 
            max-width: 300px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
        }
        .results { 
            display: none; 
            text-align: center; 
            padding: 30px; 
            background: #f0f8ff;
            border-radius: 10px;
        }
        .score { 
            font-size: 3em; 
            color: #667eea; 
            font-weight: bold; 
        }
        .participant-info { 
            background: #f0f8ff; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 20px 0; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Part 2. 숙달도 과제</h1>
            <h2 style="color: #6c757d; font-size: 1.3em; margin-top: 10px;">한국어 C-Test 온라인 평가</h2>
        </div>

        <div id="startForm">
            <h2>참여자 정보</h2>
            <div class="participant-info">
                <div class="form-group">
                    <label>이름:</label>
                    <input type="text" id="pname" placeholder="예: 홍길동" required>
                </div>
                <div class="form-group">
                    <label>나이:</label>
                    <input type="number" id="age" placeholder="예: 25" required>
                </div>
                <div class="form-group">
                    <label>전공:</label>
                    <input type="text" id="major" placeholder="예: 경영학" required>
                </div>
                <div class="form-group">
                    <label>모어:</label>
                    <input type="text" id="lang" placeholder="예: English" required>
                </div>
                <div class="form-group">
                    <label>한국어 학습 기간:</label>
                    <select id="duration" required>
                        <option value="">선택하세요</option>
                        <option value="6개월 미만">6개월 미만</option>
                        <option value="6개월-1년">6개월-1년</option>
                        <option value="1-3년">1-3년</option>
                        <option value="3-5년">3-5년</option>
                        <option value="5년 이상">5년 이상</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>이메일:</label>
                    <input type="email" id="email" placeholder="example@email.com" required>
                </div>
                <div class="form-group">
                    <label>핸드폰:</label>
                    <input type="tel" id="phone" placeholder="010-1234-5678" required>
                </div>
            </div>
            <button class="btn" onclick="startTest()">시험 시작 (20분)</button>
        </div>

        <div id="testArea" style="display:none;">
            <div class="timer" id="timer">남은 시간: 20:00</div>

            <div class="passage">
                <h3>지문 1: 일상생활 (Level 1)</h3>
                <div class="passage-text">
                    안녕하세요. 제 이름은 김철수입니다. 저는 대학<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="교" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1">다닙니다.
                    아침에 일어<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="나" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="서" maxlength="1">학교 체육<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="관" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1">갑니다. 체육<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="관" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="서" maxlength="1">운동을 합<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="니" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="다" maxlength="1">.
                    운동을 한 다<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="음" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1">아침을 먹습니다. 아침은 기숙<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="사" maxlength="1">식당에서 먹습니다. 저는 대학<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="교" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="서" maxlength="1">한국어를 배<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="웁" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="니" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="다" maxlength="1">. 한국어 수<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="업" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="은" maxlength="1">매일
                    오<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="전" maxlength="1">10시에 시작<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="합" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="니" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="다" maxlength="1">. 한국어는 쓰<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="기" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="와" maxlength="1">말하기가 어<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="렵" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="습" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="니" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="다" maxlength="1">.
                    그렇지만 듣<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="기" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="와" maxlength="1">읽기는 쉽<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="습" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="니" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="다" maxlength="1">. 한국어 배<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="우" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="는" maxlength="1">것이 참 재미<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="있" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="습" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="니" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="다" maxlength="1">. 주말에는 친<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="구" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="와" maxlength="1">같이 극<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="장" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="서" maxlength="1">영화를 봅니다. 영화를 <input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="본" maxlength="1">
                    후에 한국 식당에서 저<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="녁" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="을" maxlength="1">먹습니다. 한국 식<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="당" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="이" maxlength="1">극장 바<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="로" maxlength="1">옆에
                    있습니다. 불고<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="기" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="가" maxlength="1">맛있습니다. 김치찌개는 맵습니다.
                </div>
            </div>

            <div class="passage">
                <h3>지문 2: 여행 계획 (Level 1+)</h3>
                <div class="passage-text">
                    올 여름에는 가족들과 함께 제주도에 여행을 가려고 해요. 제
                    주도는 한반<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="도" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="의" maxlength="1">남쪽에 있<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="는" maxlength="1">섬이예요. 한국의 하와이라 불<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="리" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="는" maxlength="1">
                    제주도는 자<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="연" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="이" maxlength="1">아름다워서 신혼<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="여" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="행" maxlength="1">장소로 인<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="기" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="가" maxlength="1">굉장히 많<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="아" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="요" maxlength="1">. 오늘은 여행<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="사" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1">전화를 걸<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="어" maxlength="1">서울에서 제주도<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="까" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="지" maxlength="1">왕복 비
                    행<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="기" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="표" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="를" maxlength="1">네장 예<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="약" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="했" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="어" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="요" maxlength="1">. 여행<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="사" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="서" maxlength="1">호텔도 소개<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="해" maxlength="1">주었지만 호
                    텔은 아직 안 정<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="했" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="어" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="요" maxlength="1">. 인터넷으로 정<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="보" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="를" maxlength="1">더 찾아 보<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="고" maxlength="1">어느 호
                    텔이 좋<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="은" maxlength="1">지 알아 보<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="려" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="고" maxlength="1">해요. 요<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="즘" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="은" maxlength="1">인터넷이 있<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="어" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="서" maxlength="1">호텔 뿐
                    아<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="니" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="라" maxlength="1">유명한 관<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="광" maxlength="1">명소와 맛<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="있" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="는" maxlength="1">식당도 찾아 볼 <input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="수" maxlength="1">있어서 참
                    편리해요.
                </div>
            </div>

            <div class="passage">
                <h3>지문 3: 백화점 광고 (Level 1+)</h3>
                <div class="passage-text">
                    안녕하세요. 서울역 앞에 위치한 서울 백화점입니다. 저희 백
                    화점<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="서" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="는" maxlength="1">겨울철을 맞<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="아" maxlength="1">겨울옷과 난<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="방" maxlength="1">제품을 세일<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="하" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="고" maxlength="1">있습니
                    다. 직장 여<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="성" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="을" maxlength="1">위한 여성복 코너<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="서" maxlength="1">여성 정<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="장" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="과" maxlength="1">겨울 속<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="옷" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="을" maxlength="1">
                    50 프로 세일하고 있<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="고" maxlength="1">, 삼층 아동<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="복" maxlength="1">코너에서도 코<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="트" maxlength="1">, 목도
                    리, 장<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="갑" maxlength="1">등의 겨<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="울" maxlength="1">상품이 각 30프로씩 할<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="인" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="된" maxlength="1">가격에 판<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="매" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="되" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="고" maxlength="1">
                    있습니다. 칠<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="층" maxlength="1">에서는 집안을 따<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="뜻" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="하" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="게" maxlength="1">해 줄 전<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="기" maxlength="1">히터와 가스
                    난<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="로" maxlength="1">등 다양<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="한" maxlength="1">난방용 가<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="전" maxlength="1">제품을 특가판<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="매" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="하" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="고" maxlength="1">있습니다. 저
                    <input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="희" maxlength="1">서울 백화점과 함<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="께" maxlength="1">겨울나기 준<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="비" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="를" maxlength="1">시작하세요. 고객 여러
                    분의 많은 성원 부탁드립니다. 감사합니다.
                </div>
            </div>

            <div class="passage">
                <h3>지문 4: 교통 체증 (Level 2)</h3>
                <div class="passage-text">
                    도시의 가장 큰 문제점이라면 뭐니뭐니해도 교통 문제가 제일 크
                    다. 도로에서는 교<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="통" maxlength="1">체증으로 인<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="하" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="여" maxlength="1">에너지와 시<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="간" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="이" maxlength="1">낭비된다.
                    특히 출<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="퇴" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="근" maxlength="1">시간에는 한꺼<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="번" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1">차량이 일제<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="히" maxlength="1">몰려서 도<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="로" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="가" maxlength="1">아
                    주 복<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="잡" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="하" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="다" maxlength="1">. 게다가 뉴욕 같은 대도<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="시" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="의" maxlength="1">주차난은 매<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="우" maxlength="1">심각한
                    수준<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="이" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="다" maxlength="1">. 자동<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="차" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="는" maxlength="1">점점 많아<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="지" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="는" maxlength="1">반면 주<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="차" maxlength="1">공간은 제<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="한" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="되" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="어" maxlength="1">있
                    기 때<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="문" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="에" maxlength="1">주차난이 생<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="긴" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="다" maxlength="1">. 주차장이 부족하면 사람<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="들" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="이" maxlength="1">주택
                    가 골<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="목" maxlength="1">이나 도로에까지 주차를 하<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="는" maxlength="1">경우가 많다. 이렇게 불<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="법" maxlength="1">
                    으로 주<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="차" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="된" maxlength="1">차량은 또 다시 교통 혼<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="잡" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="의" maxlength="1">원인이 되<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="어" maxlength="1">더 심<input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="각" maxlength="1"><input class="blank" type="text" inputmode="text" autocomplete="off" data-answer="한" maxlength="1">
                    교통 체증을 일으킨다. 따라서 교통 문제를 해결하기 위해서
                    는 자가용보다는 버스나 지하철을 많이 이용해야 할 것이다.
                </div>
            </div>

            <button class="btn" onclick="finishTest()">시험 완료</button>
        </div>

        <div id="resultArea" class="results">
            <div class="score" id="score">0%</div>
            <p>총 <span id="total">0</span>문항 중 <span id="correct">0</span>문항 정답</p>
            <p>사용 시간: <span id="timeUsed">0</span>분</p>
            <br>
            <button class="btn" onclick="downloadCSV()">결과 다운로드 (CSV)</button>
            
            <div style="background: #e8f5e8; border: 2px solid #4caf50; padding: 20px; border-radius: 10px; margin: 30px 0; text-align: center;">
                <h3 style="color: #2e7d32; margin-bottom: 15px;">수고 많으셨습니다. Part 2가 마무리 되었습니다.</h3>
                <p style="color: #388e3c; font-size: 1.1em; margin-bottom: 20px;">이제 Part 3. 작업 기억 과제 (15분)로 이동합니다.</p>
                <a href="https://yueunlee-code.github.io/korean-test/part3/" 
                   class="btn" 
                   style="background: #4caf50; text-decoration: none; display: inline-block; margin: 10px;">
                   Part 3. 작업 기억 과제 시작하기
                </a>
                <br>
                <small style="color: #666; margin-top: 10px; display: block;">
                    링크: https://yueunlee-code.github.io/korean-test/part3/
                </small>
            </div>
            
            <button class="btn" onclick="location.reload()" style="background: #6c757d;">다시 시작</button>
        </div>
    </div>

    <script>
        let timer = 20 * 60;
        let interval;
        let startTime;
        let userData = {};

        function startTest() {
            const pname = document.getElementById('pname').value.trim();
            const age = document.getElementById('age').value.trim();
            const major = document.getElementById('major').value.trim();
            const lang = document.getElementById('lang').value.trim();
            const duration = document.getElementById('duration').value;
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();

            if (!pname || !age || !major || !lang || !duration || !email || !phone) {
                alert('모든 정보를 입력해주세요.');
                return;
            }

            userData = { pname, age, major, lang, duration, email, phone };
            startTime = new Date();

            document.getElementById('startForm').style.display = 'none';
            document.getElementById('testArea').style.display = 'block';

            setupBlankInputs();

            interval = setInterval(function() {
                timer--;
                let min = Math.floor(timer / 60);
                let sec = timer % 60;
                document.getElementById('timer').textContent = `남은 시간: ${min}:${sec < 10 ? '0' : ''}${sec}`;
                
                if (timer <= 0) {
                    clearInterval(interval);
                    alert('시간 종료! 자동 제출됩니다.');
                    finishTest();
                }
            }, 1000);
        }

        function setupBlankInputs() {
            const blanks = document.querySelectorAll('.blank');
            blanks.forEach(function(blank, index) {
                blank.id = 'blank_' + index;
                let isComposing = false;
                let previousValue = '';
                
                blank.addEventListener('touchstart', function(e) {
                    e.stopPropagation();
                }, { passive: true });
                
                blank.addEventListener('compositionstart', function() {
                    isComposing = true;
                    previousValue = this.value;
                });
                
                blank.addEventListener('compositionend', function(e) {
                    isComposing = false;
                    setTimeout(() => {
                        processInput.call(this);
                    }, 0);
                });
                
                function processInput() {
                    let value = this.value.trim();
                    let koreanChar = value.match(/[가-힣]/g);
                    
                    if (koreanChar && koreanChar.length > 0) {
                        this.value = koreanChar[0];
                        
                        if (this.value !== previousValue) {
                            previousValue = this.value;
                            setTimeout(() => {
                                moveToNext(this);
                            }, 50);
                        }
                    } else {
                        this.value = '';
                        previousValue = '';
                    }
                }
                
                blank.addEventListener('input', function() {
                    if (!isComposing) {
                        processInput.call(this);
                    }
                });
                
                blank.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace') {
                        previousValue = '';
                        return;
                    }
                    
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        if (this.value) {
                            moveToNext(this);
                        }
                        return;
                    }
                    
                    if (e.key === 'Tab') {
                        return;
                    }
                    
                    if (this.value && !isComposing && e.key.length === 1) {
                        previousValue = '';
                        this.value = '';
                    }
                });
                
                blank.addEventListener('focus', function() {
                    previousValue = this.value;
                    if (this.value) {
                        this.select();
                    }
                });
                
                blank.addEventListener('paste', function(e) {
                    e.preventDefault();
                });
            });
        }
        
        function moveToNext(currentBlank) {
            const blanks = Array.from(document.querySelectorAll('.blank'));
            const currentIndex = blanks.indexOf(currentBlank);
            
            if (currentIndex < blanks.length - 1) {
                const nextBlank = blanks[currentIndex + 1];
                nextBlank.focus();
            }
        }

        function finishTest() {
            if (!confirm('시험을 제출하시겠습니까?')) return;
            
            clearInterval(interval);
            
            const blanks = document.querySelectorAll('.blank');
            let totalCount = 0;
            let correctCount = 0;
            let results = [];
            
            blanks.forEach(function(blank, index) {
                if (blank.dataset.answer) {
                    totalCount++;
                    const isCorrect = blank.value === blank.dataset.answer;
                    if (isCorrect) correctCount++;
                    
                    results.push({
                        item: index + 1,
                        userAnswer: blank.value,
                        correctAnswer: blank.dataset.answer,
                        correct: isCorrect
                    });
                }
            });

            const percentage = Math.round((correctCount / totalCount) * 100);
            const timeUsed = 20 - Math.floor(timer / 60);
            
            window.testResult = {
                userData: userData,
                startTime: startTime,
                endTime: new Date(),
                timeUsed: timeUsed,
                totalCount: totalCount,
                correctCount: correctCount,
                percentage: percentage,
                details: results
            };

            localStorage.setItem(`result_${userData.email.split('@')[0]}_${Date.now()}`, JSON.stringify(window.testResult));

            sendToGoogleSheets(window.testResult, 'C-Test');

            document.getElementById('testArea').style.display = 'none';
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('score').textContent = percentage + '%';
            document.getElementById('total').textContent = totalCount;
            document.getElementById('correct').textContent = correctCount;
            document.getElementById('timeUsed').textContent = timeUsed;
        }

        function downloadCSV() {
            if (!window.testResult) return;
            
            const r = window.testResult;
            let csv = '';
            
            csv += '=== 참여자 기본 정보 ===\n';
            csv += 'Name,Age,Major,MotherTongue,StudyDuration,Email,Phone,TestDate,StartTime,EndTime,TotalTimeUsed\n';
            csv += `${r.userData.pname},${r.userData.age},${r.userData.major},${r.userData.lang},"${r.userData.duration}",${r.userData.email},${r.userData.phone},${r.startTime.toLocaleDateString()},${r.startTime.toLocaleTimeString()},${r.endTime.toLocaleTimeString()},${r.timeUsed}분\n\n`;
            
            csv += '=== 점수 요약 ===\n';
            csv += 'TotalItems,CorrectCount,IncorrectCount,EmptyCount,AccuracyPercentage\n';
            const emptyCount = r.totalCount - r.correctCount - (r.details.filter(item => item.userAnswer && !item.correct).length);
            csv += `${r.totalCount},${r.correctCount},${r.details.filter(item => item.userAnswer && !item.correct).length},${emptyCount},${r.percentage}%\n\n`;
            
            csv += '=== 지문별 상세 결과 ===\n';
            csv += 'PassageNumber,PassageTitle,ItemNumber,CorrectAnswer,UserAnswer,IsCorrect,ItemType\n';
            
            const passages = [
                { title: '지문1_일상생활', start: 1, end: 56 },
                { title: '지문2_여행계획', start: 57, end: 106 },
                { title: '지문3_백화점광고', start: 107, end: 143 },
                { title: '지문4_교통체증', start: 144, end: 157 }
            ];
            
            r.details.forEach(function(item, index) {
                let passageInfo = passages.find(p => item.item >= p.start && item.item <= p.end);
                if (!passageInfo) passageInfo = { title: '기타', start: 0, end: 999 };
                
                const passageNumber = passages.indexOf(passageInfo) + 1;
                const userAnswer = item.userAnswer || '(공백)';
                const correctAnswer = item.correctAnswer;
                const isCorrect = item.correct ? 'O' : 'X';
                
                let itemType = '기타';
                if (correctAnswer.match(/[은는이가을를에서]/)) itemType = '조사';
                else if (correctAnswer.match(/[다요니습]/)) itemType = '어미';
                else if (correctAnswer.match(/[서게와아어]/)) itemType = '연결어미';
                else if (correctAnswer.length === 1) itemType = '단일음절';
                
                csv += `${passageNumber},"${passageInfo.title}",${item.item},${correctAnswer},${userAnswer},${isCorrect},${itemType}\n`;
            });
            
            csv += '\n=== 오답 분석 ===\n';
            csv += 'ItemNumber,CorrectAnswer,UserAnswer,ErrorType\n';
            r.details.forEach(function(item) {
                if (!item.correct) {
                    let errorType = '';
                    if (!item.userAnswer) errorType = '무응답';
                    else if (item.userAnswer.length !== item.correctAnswer.length) errorType = '길이오류';
                    else errorType = '대체오류';
                    
                    csv += `${item.item},${item.correctAnswer},${item.userAnswer || '(공백)'},${errorType}\n`;
                }
            });
            
            csv += '\n=== 정답률 통계 ===\n';
            csv += 'Category,Count,Percentage\n';
            const totalAnswered = r.details.filter(item => item.userAnswer).length;
            csv += `전체문항,${r.totalCount},100%\n`;
            csv += `정답,${r.correctCount},${Math.round(r.correctCount/r.totalCount*100)}%\n`;
            csv += `오답,${r.details.filter(item => item.userAnswer && !item.correct).length},${Math.round(r.details.filter(item => item.userAnswer && !item.correct).length/r.totalCount*100)}%\n`;
            csv += `무응답,${r.totalCount - totalAnswered},${Math.round((r.totalCount - totalAnswered)/r.totalCount*100)}%\n`;
            
            csv += '\n=== 지문별 정답률 ===\n';
            csv += 'PassageNumber,PassageTitle,TotalItems,CorrectItems,AccuracyRate\n';
            passages.forEach(function(passage, index) {
                const passageItems = r.details.filter(item => item.item >= passage.start && item.item <= passage.end);
                const passageCorrect = passageItems.filter(item => item.correct).length;
                const passageTotal = passageItems.length;
                const passageRate = passageTotal > 0 ? Math.round(passageCorrect/passageTotal*100) : 0;
                csv += `${index + 1},"${passage.title}",${passageTotal},${passageCorrect},${passageRate}%\n`;
            });
            
            const BOM = '\uFEFF';
            const csvWithBOM = BOM + csv;
            
            const blob = new Blob([csvWithBOM], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Korean_CTest_DetailedResults_${r.userData.email.split('@')[0]}_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function sendToGoogleSheets(testResults, testType) {
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzdXwqWVXTvEjbgyIyQoiBB6b9Ir_1efKUa0PQ-qy3kH-B7vxGwR_aIjAn0xbYySXGllg/exec';
            
            const summary = testType === 'C-Test' ? 
                `C-Test 정답: ${testResults.correctCount}/${testResults.totalCount}, 정답률: ${testResults.percentage}%, 소요시간: ${testResults.timeUsed}분` :
                `${testType} 완료`;
            
            const payload = {
                participantId: testResults.userData.email,
                participantName: testResults.userData.pname,
                testType: testType,
                summary: summary,
                details: {
                    participantInfo: testResults.userData,
                    testResults: testResults,
                    timestamp: new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }),
                    site: 'korean-test-main'
                }
            };
            
            console.log('Google Sheets 백업 시도 중...', payload);
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(response => {
                console.log(`${testType} 결과 백업 요청이 전송되었습니다.`);
                return 'success';
            })
            .catch(error => {
                console.error('백업 실패:', error);
            });
        }

        console.log('한국어 C-Test가 로드되었습니다.');
        console.log('총 157개 빈칸이 구현되었습니다.');
        console.log('Google Sheets 자동 백업 기능이 준비되었습니다.');
    </script>
</body>
</html>
